/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["org.cometd"]){dojo._hasResource["org.cometd"]=true;if(typeof dojo!=="undefined"){dojo.provide("org.cometd");}else{this.org=this.org||{};org.cometd={};}org.cometd.JSON={};org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(_1){throw "Abstract";};org.cometd.TransportRegistry=function(){var _2=[];var _3={};this.getTransportTypes=function(){return _2.slice(0);};this.findTransportTypes=function(_4,_5){var _6=[];for(var i=0;i<_2.length;++i){var _7=_2[i];if(_3[_7].accept(_4,_5)){_6.push(_7);}}return _6;};this.negotiateTransport=function(_8,_9,_a){for(var i=0;i<_2.length;++i){var _b=_2[i];for(var j=0;j<_8.length;++j){if(_b==_8[j]){var _c=_3[_b];if(_c.accept(_9,_a)===true){return _c;}}}}return null;};this.add=function(_d,_e,_f){var _10=false;for(var i=0;i<_2.length;++i){if(_2[i]==_d){_10=true;break;}}if(!_10){if(typeof _f!=="number"){_2.push(_d);}else{_2.splice(_f,0,_d);}_3[_d]=_e;}return !_10;};this.remove=function(_11){for(var i=0;i<_2.length;++i){if(_2[i]==_11){_2.splice(i,1);var _12=_3[_11];delete _3[_11];return _12;}}return null;};this.reset=function(){for(var i=0;i<_2.length;++i){_3[_2[i]].reset();}};};org.cometd.Cometd=function(_13){var _14=this;var _15=_13||"default";var _16;var _17;var _18;var _19;var _1a;var _1b;var _1c;var _1d;var _1e;var _1f;var _20=false;var _21=new org.cometd.TransportRegistry();var _22;var _23="disconnected";var _24=0;var _25=null;var _26=0;var _27=[];var _28=false;var _29={};var _2a=0;var _2b=null;var _2c=[];var _2d={};var _2e={};var _2f;var _30=false;var _31=false;function _32(_33,_34,_35){var _36=_34||{};for(var i=2;i<arguments.length;++i){var _37=arguments[i];if(_37===undefined||_37===null){continue;}for(var _38 in _37){var _39=_37[_38];if(_39===_34){continue;}if(_39===undefined){continue;}if(_33&&typeof _39==="object"&&_39!==null){if(_39 instanceof Array){_36[_38]=_32(_33,[],_39);}else{_36[_38]=_32(_33,{},_39);}}else{_36[_38]=_39;}}}return _36;};this._mixin=_32;function _3a(_3b,_3c){for(var i=0;i<_3c.length;++i){if(_3b==_3c[i]){return i;}}return -1;};function _3d(_3e){if(_3e===undefined||_3e===null){return false;}return typeof _3e==="string"||_3e instanceof String;};function _3f(_40){if(_40===undefined||_40===null){return false;}return _40 instanceof Array;};function _41(_42){if(_42===undefined||_42===null){return false;}return typeof _42==="function";};function _43(_44,_45){if(window.console){var _46=window.console[_44];if(_41(_46)){_46.apply(window.console,_45);}}};function _47(){_43("warn",arguments);};this._warn=_47;function _48(){if(_16!="warn"){_43("info",arguments);}};this._info=_48;function _49(){if(_16=="debug"){_43("debug",arguments);}};this._debug=_49;function _4a(_4b){_49("Configuring cometd object with",_4b);if(_3d(_4b)){_4b={url:_4b};}if(!_4b){_4b={};}_17=_4b.url;if(!_17){throw "Missing required configuration parameter 'url' specifying the Bayeux server URL";}_18=_4b.maxConnections||2;_19=_4b.backoffIncrement||1000;_1a=_4b.maxBackoff||60000;_16=_4b.logLevel||"info";_1b=_4b.reverseIncomingExtensions!==false;_1c=_4b.maxNetworkDelay||10000;_1d=_4b.requestHeaders||{};_1e=_4b.appendMessageTypeToURL!==false;_1f=_4b.autoBatch===true;_2d.timeout=_4b.timeout||60000;_2d.interval=_4b.interval||0;_2d.reconnect=_4b.reconnect||"retry";var _4c=/(^https?:)?(\/\/(([^:\/\?#]+)(:(\d+))?))?([^\?#]*)(.*)?/.exec(_17);_20=_4c[3]&&_4c[3]!=window.location.host;if(_1e){if(_4c[8]!==undefined){_48("Appending message type to URI "+_4c[7]+_4c[8]+" is not supported, disabling 'appendMessageTypeToURL' configuration");_1e=false;}else{var _4d=_4c[7].split("/");var _4e=_4d.length-1;if(_4c[7].match(/\/$/)){_4e-=1;}if(_4d[_4e].indexOf(".")>=0){_48("Appending message type to URI "+_4c[7]+" is not supported, disabling 'appendMessageTypeToURL' configuration");_1e=false;}}}};function _4f(){for(var _50 in _29){var _51=_29[_50];for(var i=0;i<_51.length;++i){var _52=_51[i];if(_52&&!_52.listener){delete _51[i];_49("Removed subscription",_52,"for channel",_50);}}}};function _53(_54){if(_23!=_54){_49("Status",_23,"->",_54);_23=_54;}};function _55(){return _23=="disconnecting"||_23=="disconnected";};function _56(){return ++_24;};function _57(_58,_59,_5a,_5b,_5c){try{return _59.call(_58,_5b);}catch(x){_49("Exception during execution of extension",_5a,x);var _5d=_14.onExtensionException;if(_41(_5d)){_49("Invoking extension exception callback",_5a,x);try{_5d.call(_14,x,_5a,_5c,_5b);}catch(xx){_48("Exception during execution of exception callback in extension",_5a,xx);}}return _5b;}};function _5e(_5f){for(var i=0;i<_2c.length;++i){if(_5f===undefined||_5f===null){break;}var _60=_1b?_2c.length-1-i:i;var _61=_2c[_60];var _62=_61.extension.incoming;if(_41(_62)){var _63=_57(_61.extension,_62,_61.name,_5f,false);_5f=_63===undefined?_5f:_63;}}return _5f;};function _64(_65){for(var i=0;i<_2c.length;++i){if(_65===undefined||_65===null){break;}var _66=_2c[i];var _67=_66.extension.outgoing;if(_41(_67)){var _68=_57(_66.extension,_67,_66.name,_65,true);_65=_68===undefined?_65:_68;}}return _65;};function _69(_6a,_6b){var _6c=_29[_6a];if(_6c&&_6c.length>0){for(var i=0;i<_6c.length;++i){var _6d=_6c[i];if(_6d){try{_6d.callback.call(_6d.scope,_6b);}catch(x){_49("Exception during notification",_6d,_6b,x);var _6e=_14.onListenerException;if(_41(_6e)){_49("Invoking listener exception callback",_6d,x);try{_6e.call(_14,x,_6d.handle,_6d.listener,_6b);}catch(xx){_48("Exception during execution of listener callback",_6d,xx);}}}}}}};function _6f(_70,_71){_69(_70,_71);var _72=_70.split("/");var _73=_72.length-1;for(var i=_73;i>0;--i){var _74=_72.slice(0,i).join("/")+"/*";if(i==_73){_69(_74,_71);}_74+="*";_69(_74,_71);}};function _75(_76,_77){return setTimeout(function(){try{_76();}catch(x){_49("Exception invoking timed function",_76,x);}},_77);};function _78(){if(_2b!==null){clearTimeout(_2b);}_2b=null;};function _79(_7a){_78();var _7b=_2e.interval+_2a;_49("Function scheduled in",_7b,"ms, interval =",_2e.interval,"backoff =",_2a,_7a);_2b=_75(_7a,_7b);};var _7c;var _7d;function _7e(_7f,_80,_81,_82){for(var i=0;i<_80.length;++i){var _83=_80[i];_83.id=""+_56();if(_25){_83.clientId=_25;}_83=_64(_83);if(_83!==undefined&&_83!==null){_80[i]=_83;}else{_80.splice(i--,1);}}if(_80.length===0){return;}var url=_17;if(_1e){if(!url.match(/\/$/)){url=url+"/";}if(_82){url=url+_82;}}var _84={url:url,sync:_7f,messages:_80,onSuccess:function(_85){try{_7c.call(_14,_85);}catch(x){_49("Exception during handling of messages",x);}},onFailure:function(_86,_87,_88){try{_7d.call(_14,_86,_80,_87,_88);}catch(x){_49("Exception during handling of failure",x);}}};_49("Send, sync =",_7f,_84);_22.send(_84,_81);};function _89(_8a){if(_26>0||_28===true){_27.push(_8a);}else{_7e(false,[_8a],false);}};this.send=_89;function _8b(){_2a=0;};function _8c(){if(_2a<_1a){_2a+=_19;}};function _8d(){++_26;};function _8e(){var _8f=_27;_27=[];if(_8f.length>0){_7e(false,_8f,false);}};function _90(){--_26;if(_26<0){throw "Calls to startBatch() and endBatch() are not paired";}if(_26===0&&!_55()&&!_28){_8e();}};function _91(){if(!_55()){var _92={channel:"/meta/connect",connectionType:_22.getType()};if(!_31){_92.advice={timeout:0};}_53("connecting");_49("Connect sent",_92);_7e(false,[_92],true,"connect");_53("connected");}};function _93(){_53("connecting");_79(function(){_91();});};function _94(_95){if(_95){_2e=_32(false,{},_2d,_95);_49("New advice",_2e,org.cometd.JSON.toJSON(_2e));}};function _96(_97){_25=null;_4f();if(_55()){_21.reset();}if(_55()){_94(_2d);}else{_94(_32(false,_2e,{reconnect:"retry"}));}_26=0;_28=true;_2f=_97;var _98="1.0";var _99=_21.findTransportTypes(_98,_20);var _9a={version:_98,minimumVersion:"0.9",channel:"/meta/handshake",supportedConnectionTypes:_99,advice:{timeout:_2e.timeout,interval:_2e.interval}};var _9b=_32(false,{},_2f,_9a);_22=_21.negotiateTransport(_99,_98,_20);_49("Initial transport is",_22);_53("handshaking");_49("Handshake sent",_9b);_7e(false,[_9b],false,"handshake");};function _9c(){_53("handshaking");_28=true;_79(function(){_96(_2f);});};function _9d(_9e){if(_9e.successful){_25=_9e.clientId;var _9f=_21.negotiateTransport(_9e.supportedConnectionTypes,_9e.version,_20);if(_9f===null){throw "Could not negotiate transport with server; client "+_21.findTransportTypes(_9e.version,_20)+", server "+_9e.supportedConnectionTypes;}else{if(_22!=_9f){_49("Transport",_22,"->",_9f);_22=_9f;}}_28=false;_8e();_9e.reestablish=_30;_30=true;_6f("/meta/handshake",_9e);var _a0=_55()?"none":_2e.reconnect;switch(_a0){case "retry":_8b();_93();break;case "none":_8b();_53("disconnected");break;default:throw "Unrecognized advice action "+_a0;}}else{_6f("/meta/handshake",_9e);_6f("/meta/unsuccessful",_9e);var _a1=!_55()&&_2e.reconnect!="none";if(_a1){_8c();_9c();}else{_8b();_53("disconnected");}}};function _a2(xhr,_a3){var _a4={successful:false,failure:true,channel:"/meta/handshake",request:_a3,xhr:xhr,advice:{reconnect:"retry",interval:_2a}};_6f("/meta/handshake",_a4);_6f("/meta/unsuccessful",_a4);var _a5=!_55()&&_2e.reconnect!="none";if(_a5){_8c();_9c();}else{_8b();_53("disconnected");}};function _a6(_a7){_31=_a7.successful;if(_31){_6f("/meta/connect",_a7);var _a8=_55()?"none":_2e.reconnect;switch(_a8){case "retry":_8b();_93();break;case "none":_8b();_53("disconnected");break;default:throw "Unrecognized advice action "+_a8;}}else{_48("Connect failed:",_a7.error);_6f("/meta/connect",_a7);_6f("/meta/unsuccessful",_a7);var _a9=_55()?"none":_2e.reconnect;switch(_a9){case "retry":_8c();_93();break;case "handshake":_8b();_9c();break;case "none":_8b();_53("disconnected");break;default:throw "Unrecognized advice action"+_a9;}}};function _aa(xhr,_ab){_31=false;var _ac={successful:false,failure:true,channel:"/meta/connect",request:_ab,xhr:xhr,advice:{reconnect:"retry",interval:_2a}};_6f("/meta/connect",_ac);_6f("/meta/unsuccessful",_ac);var _ad=_55()?"none":_2e.reconnect;switch(_ad){case "retry":_8c();_93();break;case "handshake":_8b();_9c();break;case "none":_8b();_53("disconnected");break;default:throw "Unrecognized advice action"+_ad;}};function _ae(_af){_78();if(_af){_22.abort();}_25=null;_53("disconnected");_26=0;_27=[];_8b();};function _b0(_b1){if(_b1.successful){_ae(false);_6f("/meta/disconnect",_b1);}else{_ae(true);_6f("/meta/disconnect",_b1);_6f("/meta/unsuccessful",_b1);}};function _b2(xhr,_b3){_ae(true);var _b4={successful:false,failure:true,channel:"/meta/disconnect",request:_b3,xhr:xhr,advice:{reconnect:"none",interval:0}};_6f("/meta/disconnect",_b4);_6f("/meta/unsuccessful",_b4);};function _b5(_b6){if(_b6.successful){_6f("/meta/subscribe",_b6);}else{_48("Subscription to",_b6.subscription,"failed:",_b6.error);_6f("/meta/subscribe",_b6);_6f("/meta/unsuccessful",_b6);}};function _b7(xhr,_b8){var _b9={successful:false,failure:true,channel:"/meta/subscribe",request:_b8,xhr:xhr,advice:{reconnect:"none",interval:0}};_6f("/meta/subscribe",_b9);_6f("/meta/unsuccessful",_b9);};function _ba(_bb){if(_bb.successful){_6f("/meta/unsubscribe",_bb);}else{_48("Unsubscription to",_bb.subscription,"failed:",_bb.error);_6f("/meta/unsubscribe",_bb);_6f("/meta/unsuccessful",_bb);}};function _bc(xhr,_bd){var _be={successful:false,failure:true,channel:"/meta/unsubscribe",request:_bd,xhr:xhr,advice:{reconnect:"none",interval:0}};_6f("/meta/unsubscribe",_be);_6f("/meta/unsuccessful",_be);};function _bf(_c0){if(_c0.successful===undefined){if(_c0.data){_6f(_c0.channel,_c0);}else{_49("Unknown message",_c0);}}else{if(_c0.successful){_6f("/meta/publish",_c0);}else{_48("Publish failed:",_c0.error);_6f("/meta/publish",_c0);_6f("/meta/unsuccessful",_c0);}}};function _c1(xhr,_c2){var _c3={successful:false,failure:true,channel:_c2.channel,request:_c2,xhr:xhr,advice:{reconnect:"none",interval:0}};_6f("/meta/publish",_c3);_6f("/meta/unsuccessful",_c3);};function _c4(_c5){_c5=_5e(_c5);if(_c5===undefined||_c5===null){return;}_94(_c5.advice);var _c6=_c5.channel;switch(_c6){case "/meta/handshake":_9d(_c5);break;case "/meta/connect":_a6(_c5);break;case "/meta/disconnect":_b0(_c5);break;case "/meta/subscribe":_b5(_c5);break;case "/meta/unsubscribe":_ba(_c5);break;default:_bf(_c5);break;}};this.receive=_c4;_7c=function _7c(_c7){_49("Received",_c7,org.cometd.JSON.toJSON(_c7));for(var i=0;i<_c7.length;++i){var _c8=_c7[i];_c4(_c8);}};_7d=function _7d(_c9,_ca,_cb,_cc){_49("handleFailure",_c9,_ca,_cb,_cc);for(var i=0;i<_ca.length;++i){var _cd=_ca[i];var _ce=_cd.channel;switch(_ce){case "/meta/handshake":_a2(_c9,_cd);break;case "/meta/connect":_aa(_c9,_cd);break;case "/meta/disconnect":_b2(_c9,_cd);break;case "/meta/subscribe":_b7(_c9,_cd);break;case "/meta/unsubscribe":_bc(_c9,_cd);break;default:_c1(_c9,_cd);break;}}};function _cf(_d0){var _d1=_29[_d0];if(_d1){for(var i=0;i<_d1.length;++i){if(_d1[i]){return true;}}}return false;};function _d2(_d3,_d4){var _d5={scope:_d3,method:_d4};if(_41(_d3)){_d5.scope=undefined;_d5.method=_d3;}else{if(_3d(_d4)){if(!_d3){throw "Invalid scope "+_d3;}_d5.method=_d3[_d4];if(!_41(_d5.method)){throw "Invalid callback "+_d4+" for scope "+_d3;}}else{if(!_41(_d4)){throw "Invalid callback "+_d4;}}}return _d5;};function _d6(_d7,_d8,_d9,_da){var _db=_d2(_d8,_d9);_49("Adding listener on",_d7,"with scope",_db.scope,"and callback",_db.method);var _dc={channel:_d7,scope:_db.scope,callback:_db.method,listener:_da};var _dd=_29[_d7];if(!_dd){_dd=[];_29[_d7]=_dd;}var _de=_dd.push(_dc)-1;_dc.id=_de;_dc.handle=[_d7,_de];_49("Added listener",_dc,"for channel",_d7,"having id =",_de);return _dc.handle;};function _df(_e0){var _e1=_29[_e0[0]];if(_e1){delete _e1[_e0[1]];_49("Removed listener",_e0);}};this.registerTransport=function(_e2,_e3,_e4){var _e5=_21.add(_e2,_e3,_e4);if(_e5){_49("Registered transport",_e2);if(_41(_e3.registered)){_e3.registered(_e2,this);}}return _e5;};this.getTransportTypes=function(){return _21.getTransportTypes();};this.unregisterTransport=function(_e6){var _e7=_21.remove(_e6);if(_e7!==null){_49("Unregistered transport",_e6);if(_41(_e7.unregistered)){_e7.unregistered();}}return _e7;};this.configure=function(_e8){_4a.call(this,_e8);};this.init=function(_e9,_ea){this.configure(_e9);this.handshake(_ea);};this.handshake=function(_eb){_53("disconnected");_30=false;_96(_eb);};this.disconnect=function(_ec,_ed){if(_55()){return;}if(_ed===undefined){if(typeof _ec!=="boolean"){_ed=_ec;_ec=false;}}var _ee={channel:"/meta/disconnect"};var _ef=_32(false,{},_ed,_ee);_53("disconnecting");_7e(_ec===true,[_ef],false,"disconnect");};this.startBatch=function(){_8d();};this.endBatch=function(){_90();};this.batch=function(_f0,_f1){var _f2=_d2(_f0,_f1);this.startBatch();try{_f2.method.call(_f2.scope);this.endBatch();}catch(x){_49("Exception during execution of batch",x);this.endBatch();throw x;}};this.addListener=function(_f3,_f4,_f5){if(arguments.length<2){throw "Illegal arguments number: required 2, got "+arguments.length;}if(!_3d(_f3)){throw "Illegal argument type: channel must be a string";}return _d6(_f3,_f4,_f5,true);};this.removeListener=function(_f6){if(!_3f(_f6)){throw "Invalid argument: expected subscription, not "+_f6;}_df(_f6);};this.clearListeners=function(){_29={};};this.subscribe=function(_f7,_f8,_f9,_fa){if(arguments.length<2){throw "Illegal arguments number: required 2, got "+arguments.length;}if(!_3d(_f7)){throw "Illegal argument type: channel must be a string";}if(_55()){throw "Illegal state: already disconnected";}if(_41(_f8)){_fa=_f9;_f9=_f8;_f8=undefined;}var _fb=!_cf(_f7);var _fc=_d6(_f7,_f8,_f9,false);if(_fb){var _fd={channel:"/meta/subscribe",subscription:_f7};var _fe=_32(false,{},_fa,_fd);_89(_fe);}return _fc;};this.unsubscribe=function(_ff,_100){if(arguments.length<1){throw "Illegal arguments number: required 1, got "+arguments.length;}if(_55()){throw "Illegal state: already disconnected";}this.removeListener(_ff);var _101=_ff[0];if(!_cf(_101)){var _102={channel:"/meta/unsubscribe",subscription:_101};var _103=_32(false,{},_100,_102);_89(_103);}};this.clearSubscriptions=function(){_4f();};this.publish=function(_104,_105,_106){if(arguments.length<1){throw "Illegal arguments number: required 1, got "+arguments.length;}if(!_3d(_104)){throw "Illegal argument type: channel must be a string";}if(_55()){throw "Illegal state: already disconnected";}var _107={channel:_104,data:_105};var _108=_32(false,{},_106,_107);_89(_108);};this.getStatus=function(){return _23;};this.isDisconnected=_55;this.setBackoffIncrement=function(_109){_19=_109;};this.getBackoffIncrement=function(){return _19;};this.getBackoffPeriod=function(){return _2a;};this.setLogLevel=function(_10a){_16=_10a;};this.registerExtension=function(name,_10b){if(arguments.length<2){throw "Illegal arguments number: required 2, got "+arguments.length;}if(!_3d(name)){throw "Illegal argument type: extension name must be a string";}var _10c=false;for(var i=0;i<_2c.length;++i){var _10d=_2c[i];if(_10d.name==name){_10c=true;break;}}if(!_10c){_2c.push({name:name,extension:_10b});_49("Registered extension",name);if(_41(_10b.registered)){_10b.registered(name,this);}return true;}else{_48("Could not register extension with name",name,"since another extension with the same name already exists");return false;}};this.unregisterExtension=function(name){if(!_3d(name)){throw "Illegal argument type: extension name must be a string";}var _10e=false;for(var i=0;i<_2c.length;++i){var _10f=_2c[i];if(_10f.name==name){_2c.splice(i,1);_10e=true;_49("Unregistered extension",name);var ext=_10f.extension;if(_41(ext.unregistered)){ext.unregistered();}break;}}return _10e;};this.getExtension=function(name){for(var i=0;i<_2c.length;++i){var _110=_2c[i];if(_110.name==name){return _110.extension;}}return null;};this.getName=function(){return _15;};this.getClientId=function(){return _25;};this.getURL=function(){return _17;};this.getTransport=function(){return _22;};org.cometd.Transport=function(){var _111;this.registered=function(type,_112){_111=type;};this.unregistered=function(){_111=null;};this.convertToMessages=function(_113){if(_3d(_113)){try{return org.cometd.JSON.fromJSON(_113);}catch(x){_49("Could not convert to JSON the following string","\""+_113+"\"");throw x;}}if(_3f(_113)){return _113;}if(_113===undefined||_113===null){return [];}if(_113 instanceof Object){return [_113];}throw "Conversion Error "+_113+", typeof "+(typeof _113);};this.accept=function(_114,_115){throw "Abstract";};this.getType=function(){return _111;};this.send=function(_116,_117){throw "Abstract";};this.reset=function(){};};org.cometd.Transport.derive=function(_118){function F(){};F.prototype=_118;return new F();};org.cometd.RequestTransport=function(){var _119=new org.cometd.Transport();var that=org.cometd.Transport.derive(_119);var _11a=0;var _11b=null;var _11c=[];var _11d=[];function _11e(_11f){var _120=_11f.id;_49("metaConnect complete",this.getType(),_120);if(_11b!==null&&_11b.id!==_120){throw "Longpoll request mismatch, completing request "+_120;}_11b=null;};function _121(_122){while(_11d.length>0){var _123=_11d[0];var _124=_123[0];var _125=_123[1];if(_124.url===_122.url&&_124.sync===_122.sync){_11d.shift();_122.messages=_122.messages.concat(_124.messages);_49("Coalesced",_124.messages.length,"messages from request",_125.id);continue;}break;}};function _126(_127,_128){var self=this;var _129=_3a(_127,_11c);if(_129>=0){_11c.splice(_129,1);}if(_11d.length>0){var _12a=_11d.shift();var _12b=_12a[0];var _12c=_12a[1];_49("Transport dequeued request",_12c.id);if(_128){if(_1f){_121(_12b);}_89.call(this,_12b);_49("Transport completed request",_127.id,_12b);}else{setTimeout(function(){self.complete(_12c,false,_12c.metaConnect);_12b.onFailure(_12c.xhr,"error","Previous request failed");},0);}}};that.complete=function(_12d,_12e,_12f){if(_12f){_11e.call(this,_12d);}else{_126.call(this,_12d,_12e);}};that.transportSend=function(_130,_131){throw "Abstract";};that.transportSuccess=function(_132,_133,_134){if(!_133.expired){clearTimeout(_133.timeout);this.complete(_133,true,_133.metaConnect);if(_134&&_134.length>0){_132.onSuccess(_134);}else{_132.onFailure(_133,"Empty HTTP response");}}};that.transportFailure=function(_135,_136,_137,_138){if(!_136.expired){clearTimeout(_136.timeout);this.complete(_136,false,_136.metaConnect);_135.onFailure(_136.xhr,_137,_138);}};function _139(_13a,_13b){var self=this;this.transportSend(_13a,_13b);_13b.expired=false;if(!_13a.sync){var _13c=_1c;if(_13b.metaConnect===true){_13c+=_2e.timeout;}_49("Will wait at most",_13c,"ms for the response, maxNetworkDelay =",_1c);_13b.timeout=_75(function(){_13b.expired=true;if(_13b.xhr){_13b.xhr.abort();}var _13d="Request "+_13b.id+" of transport "+self.getType()+" exceeded "+_13c+" ms max network delay";_49(_13d);self.complete(_13b,false,_13b.metaConnect);_13a.onFailure(_13b.xhr,"timeout",_13d);},_13c);}};function _13e(_13f){if(_11b!==null){throw "Concurrent metaConnect requests not allowed, request id="+_11b.id+" not yet completed";}var _140=++_11a;_49("metaConnect send ",this.getType(),_140,_13f);var _141={id:_140,metaConnect:true};_139.call(this,_13f,_141);_11b=_141;};function _89(_142){var _143=++_11a;var _144={id:_143,metaConnect:false};if(_11c.length<_18-1){_49("Transport sending request",_143,_142);_139.call(this,_142,_144);_11c.push(_144);}else{_49("Transport queueing request",_143,_142);_11d.push([_142,_144]);}};that.send=function(_145,_146){if(_146){_13e.call(this,_145);}else{_89.call(this,_145);}};that.abort=function(){for(var i=0;i<_11c.length;++i){var _147=_11c[i];_49("Aborting request",_147);if(_147.xhr){_147.xhr.abort();}}if(_11b){_49("Aborting metaConnect request",_11b);if(_11b.xhr){_11b.xhr.abort();}}this.reset();};that.reset=function(){_11b=null;_11c=[];_11d=[];};that.toString=function(){return this.getType();};return that;};org.cometd.LongPollingTransport=function(){var _148=new org.cometd.RequestTransport();var that=org.cometd.Transport.derive(_148);var _149=true;that.accept=function(_14a,_14b){return _149||!_14b;};that.xhrSend=function(_14c){throw "Abstract";};that.transportSend=function(_14d,_14e){var self=this;try{var _14f=true;_14e.xhr=this.xhrSend({transport:this,url:_14d.url,sync:_14d.sync,headers:_1d,body:org.cometd.JSON.toJSON(_14d.messages),onSuccess:function(_150){_49("Transport",self,"received response",_150);var _151=false;try{var _152=self.convertToMessages(_150);if(_152.length===0){_149=false;self.transportFailure(_14d,_14e,"no response",null);}else{_151=true;self.transportSuccess(_14d,_14e,_152);}}catch(x){_49(x);if(!_151){_149=false;self.transportFailure(_14d,_14e,"bad response",x);}}},onError:function(_153,_154){_149=false;if(_14f){_75(function(){self.transportFailure(_14d,_14e,_153,_154);},0);}else{self.transportFailure(_14d,_14e,_153,_154);}}});_14f=false;}catch(x){_149=false;_75(function(){self.transportFailure(_14d,_14e,"error",x);},0);}};that.reset=function(){_148.reset();_149=true;};return that;};org.cometd.CallbackPollingTransport=function(){var _155=new org.cometd.RequestTransport();var that=org.cometd.Transport.derive(_155);var _156=2000;that.accept=function(_157,_158){return true;};that.jsonpSend=function(_159){throw "Abstract";};that.transportSend=function(_15a,_15b){var self=this;var _15c=org.cometd.JSON.toJSON(_15a.messages);var _15d=_15a.url.length+encodeURI(_15c).length;if(_15d>_156){var x=_15a.messages.length>1?"Too many bayeux messages in the same batch resulting in message too big "+"("+_15d+" bytes, max is "+_156+") for transport "+this.getType():"Bayeux message too big ("+_15d+" bytes, max is "+_156+") "+"for transport "+this.getType();_75(function(){self.transportFailure(_15a,_15b,"error",x);},0);}else{try{var _15e=true;this.jsonpSend({transport:this,url:_15a.url,sync:_15a.sync,headers:_1d,body:_15c,onSuccess:function(_15f){var _160=false;try{var _161=self.convertToMessages(_15f);if(_161.length===0){self.transportFailure(_15a,_15b,"no response",null);}else{_160=true;self.transportSuccess(_15a,_15b,_161);}}catch(x){_49(x);if(!_160){self.transportFailure(_15a,_15b,"bad response",x);}}},onError:function(_162,_163){if(_15e){_75(function(){self.transportFailure(_15a,_15b,_162,_163);},0);}else{self.transportFailure(_15a,_15b,_162,_163);}}});_15e=false;}catch(xx){_75(function(){self.transportFailure(_15a,_15b,"error",xx);},0);}}};return that;};org.cometd.WebSocketTransport=function(){var _164=new org.cometd.Transport();var that=org.cometd.Transport.derive(_164);var _165;var _166=true;var _167;var _168;var _169;var _16a={};var _16b;if(window.WebSocket){_16b=window.WebSocket;_168=_16b.CLOSED;}function _16c(_16d,_16e){if(_165.send(org.cometd.JSON.toJSON(_16d.messages))){var _16f=_1c;if(_16e){_16f+=_2e.timeout;}for(var i=0;i<_16d.messages.length;++i){var _170=_16d.messages[i];if(_170.id){_16a[_170.id]=_75(function(){delete _16a[_170.id];var _171="TIMEOUT message "+_170.id+" exceeded "+_16f+"ms";_49(_171);_16d.onFailure(_165,"timeout",_171);},_16f);_49("waiting",_16f," for  ",_170.id,org.cometd.JSON.toJSON(_16a));}}}else{_75(function(){_16d.onFailure(_165,"failed",null);},0);}};that.accept=function(_172,_173){return _166&&_16b!==null&&typeof _16b==="function";};that.send=function(_174,_175){_49("Transport",this,"sending",_174,"metaConnect",_175);if(_175){_169=_174;}else{_167=_174;}if(_168===_16b.OPEN){_16c(_174,_175);}else{var url=_174.url.replace(/^http/,"ws");_49("Transport",this,"URL",url);var self=this;var _176=new _16b(url);_176.onopen=function(){_49("Opened",_176);_168=_16b.OPEN;_165=_176;_16c(_174,_175);};_176.onclose=function(){_49("Closed",_176);if(_168!==_16b.OPEN){_166=false;_174.onFailure(_176,"cannot open",null);}else{_168=_16b.CLOSED;for(var i in _16a){clearTimeout(_16a[i]);delete _16a[i];}}};_176.onmessage=function(_177){_49("Message",_177);if(_168===_16b.OPEN){var _178=self.convertToMessages(_177.data);var mc=false;for(var i=0;i<_178.length;++i){var msg=_178[i];if("/meta/connect"==msg.channelId){mc=true;}_49("timeouts",_16a,org.cometd.JSON.toJSON(_16a));if(!msg.data&&msg.id&&_16a[msg.id]){_49("timeout",_16a[msg.id]);clearTimeout(_16a[msg.id]);delete _16a[msg.id];}if("/meta/disconnect"==msg.channel&&msg.successful){_176.close();}}if(mc){_169.onSuccess(_178);}else{_167.onSuccess(_178);}}else{_174.onFailure(_176,"closed",null);}};}};that.reset=function(){_49("reset",_165);_164.reset();if(_165){_165.close();}_166=true;_168=_16b.CLOSED;_167=null;_169=null;};return that;};};}if(!dojo._hasResource["dojo.io.script"]){dojo._hasResource["dojo.io.script"]=true;dojo.provide("dojo.io.script");(function(){var _179=dojo.isIE?"onreadystatechange":"load",_17a=/complete|loaded/;dojo.io.script={get:function(args){var dfd=this._makeScriptDeferred(args);var _17b=dfd.ioArgs;dojo._ioAddQueryToUrl(_17b);dojo._ioNotifyStart(dfd);if(this._canAttach(_17b)){var node=this.attach(_17b.id,_17b.url,args.frameDoc);if(!_17b.jsonp&&!_17b.args.checkString){var _17c=dojo.connect(node,_179,function(evt){if(evt.type=="load"||_17a.test(node.readyState)){dojo.disconnect(_17c);_17b.scriptLoaded=evt;}});}}dojo._ioWatch(dfd,this._validCheck,this._ioCheck,this._resHandle);return dfd;},attach:function(id,url,_17d){var doc=(_17d||dojo.doc);var _17e=doc.createElement("script");_17e.type="text/javascript";_17e.src=url;_17e.id=id;_17e.charset="utf-8";return doc.getElementsByTagName("head")[0].appendChild(_17e);},remove:function(id,_17f){dojo.destroy(dojo.byId(id,_17f));if(this["jsonp_"+id]){delete this["jsonp_"+id];}},_makeScriptDeferred:function(args){var dfd=dojo._ioSetArgs(args,this._deferredCancel,this._deferredOk,this._deferredError);var _180=dfd.ioArgs;_180.id=dojo._scopeName+"IoScript"+(this._counter++);_180.canDelete=false;_180.jsonp=args.callbackParamName||args.jsonp;if(_180.jsonp){_180.query=_180.query||"";if(_180.query.length>0){_180.query+="&";}_180.query+=_180.jsonp+"="+(args.frameDoc?"parent.":"")+dojo._scopeName+".io.script.jsonp_"+_180.id+"._jsonpCallback";_180.frameDoc=args.frameDoc;_180.canDelete=true;dfd._jsonpCallback=this._jsonpCallback;this["jsonp_"+_180.id]=dfd;}return dfd;},_deferredCancel:function(dfd){dfd.canceled=true;if(dfd.ioArgs.canDelete){dojo.io.script._addDeadScript(dfd.ioArgs);}},_deferredOk:function(dfd){var _181=dfd.ioArgs;if(_181.canDelete){dojo.io.script._addDeadScript(_181);}return _181.json||_181.scriptLoaded||_181;},_deferredError:function(_182,dfd){if(dfd.ioArgs.canDelete){if(_182.dojoType=="timeout"){dojo.io.script.remove(dfd.ioArgs.id,dfd.ioArgs.frameDoc);}else{dojo.io.script._addDeadScript(dfd.ioArgs);}}console.log("dojo.io.script error",_182);return _182;},_deadScripts:[],_counter:1,_addDeadScript:function(_183){dojo.io.script._deadScripts.push({id:_183.id,frameDoc:_183.frameDoc});_183.frameDoc=null;},_validCheck:function(dfd){var _184=dojo.io.script;var _185=_184._deadScripts;if(_185&&_185.length>0){for(var i=0;i<_185.length;i++){_184.remove(_185[i].id,_185[i].frameDoc);_185[i].frameDoc=null;}dojo.io.script._deadScripts=[];}return true;},_ioCheck:function(dfd){var _186=dfd.ioArgs;if(_186.json||(_186.scriptLoaded&&!_186.args.checkString)){return true;}var _187=_186.args.checkString;if(_187&&eval("typeof("+_187+") != 'undefined'")){return true;}return false;},_resHandle:function(dfd){if(dojo.io.script._ioCheck(dfd)){dfd.callback(dfd);}else{dfd.errback(new Error("inconceivable dojo.io.script._resHandle error"));}},_canAttach:function(_188){return true;},_jsonpCallback:function(json){this.ioArgs.json=json;}};})();}if(!dojo._hasResource["dojox.cometd"]){dojo._hasResource["dojox.cometd"]=true;dojo.provide("dojox.cometd");dojo.registerModulePath("org","../org");org.cometd.JSON.toJSON=dojo.toJson;org.cometd.JSON.fromJSON=dojo.fromJson;dojox.cometd=new org.cometd.Cometd();dojox.cometd.LongPollingTransport=function(){var _189=new org.cometd.LongPollingTransport();var that=org.cometd.Transport.derive(_189);that.xhrSend=function(_18a){var _18b=dojo.rawXhrPost({url:_18a.url,sync:_18a.sync===true,contentType:"application/json;charset=UTF-8",headers:_18a.headers,postData:_18a.body,handleAs:"json",load:_18a.onSuccess,error:function(_18c){_18a.onError(_18c.message,_18b.ioArgs.error);}});return _18b.ioArgs.xhr;};return that;};dojox.cometd.CallbackPollingTransport=function(){var _18d=new org.cometd.CallbackPollingTransport();var that=org.cometd.Transport.derive(_18d);that.jsonpSend=function(_18e){var _18f=dojo.io.script.get({url:_18e.url,sync:_18e.sync===true,callbackParamName:"jsonp",content:{message:_18e.body},load:_18e.onSuccess,error:function(_190){_18e.onError(_190.message,_18f.ioArgs.error);}});return undefined;};return that;};if(window.WebSocket){dojox.cometd.registerTransport("websocket",new org.cometd.WebSocketTransport());}dojox.cometd.registerTransport("long-polling",new dojox.cometd.LongPollingTransport());dojox.cometd.registerTransport("callback-polling",new dojox.cometd.CallbackPollingTransport());dojox.cometd._init=dojox.cometd.init;dojox.cometd._unsubscribe=dojox.cometd.unsubscribe;dojox.cometd.unsubscribe=function(_191,_192,_193){if(typeof _191==="string"){throw "Deprecated function unsubscribe(string). Use unsubscribe(object) passing as argument the return value of subscribe()";}dojox.cometd._unsubscribe(_191);};dojox.cometd._metaHandshakeEvent=function(_194){_194.action="handshake";dojo.publish("/cometd/meta",[_194]);};dojox.cometd._metaConnectEvent=function(_195){_195.action="connect";dojo.publish("/cometd/meta",[_195]);};dojox.cometd.addListener("/meta/handshake",dojox.cometd,dojox.cometd._metaHandshakeEvent);dojox.cometd.addListener("/meta/connect",dojox.cometd,dojox.cometd._metaConnectEvent);}
