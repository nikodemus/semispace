var semispace={VERSION:"1.1.0",cometdImpl:undefined};semispace.connection={connected:false,metaListener:undefined,init:function(b){b=b||{url:location.protocol+"//"+location.host+"/semispace-comet-server/cometd",logLevel:"debug"};var c;semispace.cometdImpl=semispace.utils.detectFramework();semispace.cometdImpl.configure(b);c&&semispace.cometdImpl.removeListener(c);c=semispace.cometdImpl.addListener("/meta/handshake",function(a){semispace.connection.metaListener(1,a)});semispace.cometdImpl.addListener("/meta/connect",function(a){var d=semispace.connection.connected;
semispace.connection.connected=a.successful;if(!d&&semispace.connection.connected)semispace.connection.metaListener(2,a);else d&&!semispace.connection.connected?semispace.connection.metaListener(3,a):semispace.connection.metaListener(4,a)});semispace.cometdImpl.addListener("/meta/disconnect",function(a){semispace.connection.metaListener(5,a)});semispace.cometdImpl.addListener("/meta/subscribe",function(a){semispace.connection.metaListener(6,a)});semispace.cometdImpl.addListener("/meta/unsubscribe",
function(a){semispace.connection.metaListener(7,a)});semispace.cometdImpl.addListener("/meta/publish",function(a){semispace.connection.metaListener(8,a)});semispace.cometdImpl.addListener("/meta/unsuccessful",function(a){semispace.connection.metaListener(9,a)})},connect:function(){semispace.cometdImpl.handshake()},disconnect:function(){semispace.cometdImpl.disconnect();this.connected=false}};semispace.space={incrementedChannel:0,notify:function(b,c,a,d){var e=undefined,g=undefined,h=this.incrementedChannel;e&&semispace.cometdImpl.unsubscribe(e);e=semispace.cometdImpl.subscribe("/service/semispace/reply/notify/"+this.incrementedChannel+"/"+c,function(){});g&&semispace.cometdImpl.unsubscribe(g);g=semispace.cometdImpl.subscribe("/service/semispace/event/notify/"+this.incrementedChannel+"/"+c,function(f){semispace.utils.callbackHandler(f,d)});semispace.cometdImpl.publish("/service/semispace/call/notify/"+
this.incrementedChannel+"/"+c,{duration:a.toString(),json:b});this.incrementedChannel++;return function(){var f=undefined;f&&semispace.cometdImpl.unsubscribe(f);f=semispace.cometdImpl.subscribe("/service/semispace/reply/leasecancel/"+this.incrementedChannel,function(){});semispace.cometdImpl.publish("/service/semispace/call/leasecancel/"+this.incrementedChannel,{callId:h})}},write:function(b,c,a){var d=undefined;d&&semispace.cometdImpl.unsubscribe(d);d=semispace.cometdImpl.subscribe("/service/semispace/reply/write/"+
this.incrementedChannel,function(e){semispace.utils.callbackHandler(e,a)});semispace.cometdImpl.publish("/service/semispace/call/write/"+this.incrementedChannel,{timeToLiveMs:c.toString(),json:b});this.incrementedChannel++;return this},read:function(b,c,a){var d=undefined;d&&semispace.cometdImpl.unsubscribe(d);d=semispace.cometdImpl.subscribe("/service/semispace/reply/read/"+this.incrementedChannel,function(e){semispace.utils.callbackHandler(e,a)});semispace.cometdImpl.publish("/service/semispace/call/read/"+
this.incrementedChannel,{duration:c.toString(),json:b});this.incrementedChannel++;return this},readIfExists:function(b,c){this.read(b,0,c);return this},take:function(b,c,a){var d=undefined;d&&semispace.cometdImpl.unsubscribe(d);d=semispace.cometdImpl.subscribe("/service/semispace/reply/take/"+this.incrementedChannel,function(e){semispace.utils.callbackHandler(e,a)});semispace.cometdImpl.publish("/service/semispace/call/take/"+this.incrementedChannel,{duration:c.toString(),json:b});this.incrementedChannel++;
return this},takeIfExists:function(b,c){this.take(b,0,c);return this}};semispace.utils={detectFramework:function(){var b=undefined;if(typeof dojo!=="undefined"){dojo.require("dojox.cometd");b=dojox.cometd}else if(typeof jQuery!=="undefined")b=jQuery.cometd;return b},callbackHandler:function(b,c){if(c){var a=undefined;if(b&&b.data&&b.data.result)a=b.data.result;c(a)}}};
