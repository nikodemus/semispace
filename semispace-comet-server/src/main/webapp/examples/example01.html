<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Semispace Comet Demo</title>
    <!--
        /**
         * Copyright 2010 Trygve Lie
         *
         * Licensed under the Apache License, Version 2.0 (the "License");
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         *   http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         **/
    -->

    <link href="resources/style.css" type="text/css" rel="stylesheet" media="all" title="Example styling" />

    <!-- Semispace Comet Scripts -->
    <script type="text/javascript" src="/semispace-comet-server/dojo/dojo.js.uncompressed.js"> </script>
    <script type="text/javascript" src="http://localhost:8080/semispace-comet-server/js/semispace.js"> </script>
    <script type="text/javascript" src="http://localhost:8080/semispace-comet-server/js/core/semispace.Comet.js"> </script>

    <!-- Example -->
    <script type="text/javascript" src="resources/helpers.js"> </script>
    <script type="text/javascript">

        // Set local logger
        var localLog = function(status, message){
            var msg = 'Status is: ' + status;
            switch(status){
                case 1:
                    msg = msg + ' - Handshake is done';
                    break;
                case 2:
                    msg = msg + ' - Got connection to server';
                    break;
                case 3:
                    msg = msg + ' - No connection to server';
                    break;
                case 4:
                    msg = msg + ' - Comunicating with server';
                    break;
                case 5:
                    msg = msg + ' - Is disconnected';
                    break;
                case 6:
                    msg = msg + ' - Subscribed to channel';
                    break;
                case 7:
                    msg = msg + ' - Unsubscribed to channel';
                    break;
                case 8:
                    msg = msg + ' - A publish is performed ' + message.id;
                    break;
                case 9:
                    msg = msg + ' - Unsuccessful to communicate with server';
                    break;
                default:
                    msg = msg + ' - Unknown!';
            }
            logger('log', msg);
        };

        // Where the server is
        var server = location.protocol + '//' + location.host + '/semispace-comet-server/cometd';

        // Get DOJO cometd library
        dojo.require("dojox.cometd");
        var com = dojox.cometd;

        var myApp;
        var init = function(){
            myApp = new semispace.Comet(com, server);
            myApp.addMetaListener(localLog);
        };

        var start = function(){
            myApp.connect();
        };

        var stop = function(){
            myApp.disconnect();
        };

        var jalla = function(){
            //alert('kkkkkkkkkk');
            myApp.doWrite();
        };
        var balla = function(){
            //alert('kkkkkkkkkk');
            myApp.doTake();
        };
    </script>
</head>
<body onload="init();">
    <h1>Example 01</h1>
    <p>
        This example tests the different messages which goes over the Comet meta channel. Please try to take the server
        up and down to see the effect.
    </p>
    <div id="result"><a href="javascript:;" onclick="start();">Connect to server</a> | <a href="javascript:;" onclick="stop();">Disconnect from server</a> | <a href="javascript:;" onclick="jalla();">Write</a> | <a href="javascript:;" onclick="balla();">Read</a></div>
    <div id="log"> </div>
</body>
</html>